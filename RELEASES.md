# Secure Release Runbook

This document summarises the release expectations that complement the detailed
workflow walkthrough in [`RELEASE.md`](RELEASE.md).

## Versioning Strategy

Firewood follows [Semantic Versioning](https://semver.org/) across the entire
workspace. Every crate inherits the version declared in
[`Cargo.toml`](Cargo.toml) via `workspace.package.version`. Release tags must use
the `vMAJOR.MINOR.PATCH` format so the release workflow accepts them. Breaking
changes require a new major version; backwards-compatible features bump the
minor version; and bug fixes or security patches increment the patch version.

## CI Prerequisites

A release can only be cut by running the
[`.github/workflows/release.yml`](.github/workflows/release.yml) pipeline. The
workflow enforces the following gates:

- `cargo fmt --check` and `cargo clippy --all-targets --all-features -- -D warnings`
- Full workspace tests, including integration suites invoked from
  `scripts/test.sh`
- `cargo audit` to detect vulnerable dependencies
- `scripts/prepare_changelog.sh` to assemble release notes

Tags pushed to `main` or manual `workflow_dispatch` runs must pass these gates
before any artifacts are published.

## Artifact, Signature, and SBOM Requirements

Release artifacts are produced by `scripts/build_release.sh` for each supported
target. For every package the workflow must publish:

- The build step halts if any `backend-plonky3` alias is detected in the feature
  list. `scripts/build_release.sh` prints `error: backend-plonky3 is experimental
  and cannot be enabled for release builds`, causing the GitHub workflow to fail
  before artifacts are packaged. This guardrail keeps the experimental stub out
  of production tarballs while the backend remains under active development.【F:.github/workflows/release.yml†L115-L158】【F:scripts/build_release.sh†L70-L160】

- Tarballs containing the compiled binaries
- SHA256 manifests generated by `scripts/checksums.sh`
- Cosign signatures and certificates created via GitHub OIDC
- CycloneDX SBOMs (`cargo cyclonedx`) for each target
- SLSA provenance attestations from `scripts/provenance_attest.sh`

Use `scripts/verify_checksums.sh` to validate manifests locally and
`cosign verify-blob` to confirm the signatures reference the expected OIDC
subject (`https://github.com/ava-labs/chain/.+`).

## Rollback and Hotfix Flow

If a release needs to be rolled back:

1. Revoke the published GitHub release and mark the tag as deprecated in the
   release notes.
2. Create a corrective branch from the last known-good tag and land fixes through
   pull requests that pass the standard CI gates.
3. Trigger the release workflow with a new patch version tag (e.g. `vX.Y.Z+1`).
4. Update [`RELEASE_NOTES.md`](RELEASE_NOTES.md) and the security advisory channel
   with the rollback context and remediation steps.

Hotfixes for security issues follow the same pipeline. Coordinate disclosure via
[`SECURITY.md`](SECURITY.md), prepare patched artifacts through the release
workflow, and ensure the updated SBOMs and signatures are published alongside
the new tag.
