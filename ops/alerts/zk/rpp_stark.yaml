groups:
  - name: zk-rpp-stark
    interval: 1m
    rules:
      - alert: ZkRppStarkVerificationFailuresWarning
        expr: increase(rpp_stark_stage_checks_total{proof_backend="rpp-stark",result="fail"}[10m]) > 0
        for: 10m
        labels:
          severity: warning
          team: zk
          backend: rpp-stark
        annotations:
          summary: RPP-STARK verifier observed repeated stage failures
          description: >-
            At least one RPP-STARK verification stage ({{ $labels.stage }})
            reported result="fail" for ten minutes. Inspect the per-stage labels
            to identify whether params, public inputs, Merkle, FRI, adapter, or
            composition checks are failing and follow the on-call playbook.
          runbook_url: https://github.com/ava-labs/chain/blob/main/docs/operations/zk_backends.md#alert-triage-and-response
      - alert: ZkRppStarkVerificationFailuresCritical
        expr: increase(rpp_stark_stage_checks_total{proof_backend="rpp-stark",result="fail"}[10m]) > 3
        for: 5m
        labels:
          severity: critical
          team: zk
          backend: rpp-stark
        annotations:
          summary: RPP-STARK verifier is rejecting multiple proofs
          description: >-
            More than three RPP-STARK verification stages have failed within ten
            minutes (latest: {{ $labels.stage }}). Expect the runtime to slash
            or bypass consensus proofs; escalate to release engineering if
            mitigation fails.
          runbook_url: https://github.com/ava-labs/chain/blob/main/docs/operations/zk_backends.md#alert-triage-and-response
      - alert: ZkRppStarkLargeFailingProofs
        expr: histogram_quantile(0.90, sum(rate(rpp_stark_proof_total_bytes_by_result_bucket{proof_backend="rpp-stark",result="fail"}[10m])) by (le, proof_kind)) > 5e6
        for: 10m
        labels:
          severity: warning
          team: zk
          backend: rpp-stark
        annotations:
          summary: Failing RPP-STARK proofs are unusually large
          description: >-
            The 90th percentile failing proof size exceeded 5 MiB for ten minutes
            (kind={{ $labels.proof_kind }}). Inspect recent proof payloads and
            verifier logs for size_bucket context before slashing resumes.
          runbook_url: https://github.com/ava-labs/chain/blob/main/docs/operations/zk_backends.md#alert-triage-and-response
      - alert: ZkRppStarkVerifierLatencyCritical
        expr: histogram_quantile(0.95, sum(rate(rpp_stark_verify_duration_seconds_bucket{proof_backend="rpp-stark",proof_kind="consensus"}[5m])) by (le)) > 3.2
        for: 15m
        labels:
          severity: critical
          team: zk
          backend: rpp-stark
        annotations:
          summary: RPP-STARK verifier p95 latency above 3.2s
          description: >-
            The consensus verifier 95th percentile latency exceeded the 3.2 s SLO
            for fifteen minutes. Review recent deployments, hardware saturation,
            and proof sizes before slashing resumes.
          runbook_url: https://github.com/ava-labs/chain/blob/main/docs/operations/zk_backends.md#alert-triage-and-response
      - alert: ZkVerifierStageLatencyCritical
        expr: histogram_quantile(0.95, sum(rate(rpp_stark_verify_duration_seconds_bucket{proof_backend="rpp-stark",stage!=""}[5m])) by (le, stage)) > 1.6
        for: 10m
        labels:
          severity: critical
          team: zk
          backend: rpp-stark
        annotations:
          summary: RPP-STARK stage latency above 1.6s (p95)
          description: >-
            The {{ $labels.stage }} verification stage is running slower than expected
            for ten minutes. Inspect per-stage latency panels and recent deployments
            for regressions before resuming proof validation.
          runbook_url: https://github.com/ava-labs/chain/blob/main/docs/operations/zk_backends.md#alert-triage-and-response
      - alert: ZkProofCacheThrash
        expr: proof_cache:hit_ratio:5m{cache="gossip-proof-cache"} < 0.5 and proof_cache:evictions_per_minute:5m{cache="gossip-proof-cache"} > 30
        for: 15m
        labels:
          severity: warning
          team: zk
          backend: rpp-stark
        annotations:
          summary: Proof cache hit ratio degraded for gossip proofs
          description: >-
            Gossip proof cache hits stayed below 50% for 15 minutes while evictions
            exceeded 30 per minute. Review backend fingerprints, cache retention, or
            gossip spam before verifier load spikes further.
          runbook_url: https://github.com/ava-labs/chain/blob/main/docs/operations/zk_backends.md#alert-triage-and-response
