# Storage Tests

## Merkledb branch-factor fixtures

The `cargo xtask test-firewood` helper drives CI's Firewood feature matrix. It
now runs the Ethereum compatibility suite (`cargo test -p firewood --locked
--features ethhash`) after replaying the deterministic branch-factor fixtures
described below, so coverage spans the default, `io-uring`, branch-factor 256,
and `ethhash` hashing modes. Keeping the fixtures fresh ensures both the
Merkledb-compatibility and Ethereum-compatibility checks validate the latest
behavior.

The deterministic hash fixtures for branch factor 256 live in
`tests/storage/fixtures/branch_factor_256/hashlists.json`. They are generated by
running the embedded Go tool, which replays a deterministic set of operations
against `avalanchego`'s Merkledb and records the resulting root hashes.

Regenerate the fixtures with:

```sh
cd tests/storage/fixtures/branch_factor_256
go run ./cmd/generate
```

The command overwrites `hashlists.json` in-place. Commit both the updated JSON
file and any changes to the generator if you change the generation logic.
