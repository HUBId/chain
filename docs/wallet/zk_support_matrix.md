# Wallet zk backend and config support matrix

The table below summarizes which wallet proving features are supported for each zk backend and how they interact with the size and determinism gates. Build flags refer to the wallet binaries; node-side verifier feature flags remain documented under [`docs/zk_backends.md`](../zk_backends.md).

| Wallet backend | Build feature flag | Runtime config knobs | Size gate support | Deterministic mode | Recommended settings and CI coverage | Known limitations |
| --- | --- | --- | --- | --- | --- | --- |
| Mock (default) | `prover-mock` (enabled by default) | `wallet.prover.backend = "mock"`; optional `require_proof` / `allow_broadcast_without_proof` toggles | Shares the `wallet.prover.max_witness_bytes` ceiling; oversized drafts abort early with a predictable error path.【F:docs/wallet_phase2_policies_prover.md†L67-L74】【F:config/wallet.toml†L113-L131】 | Honours `RPP_PROVER_DETERMINISTIC`; deterministic proofs primarily reduce CI noise for the mock circuit.【F:docs/architecture/prover-backends.md†L87-L92】 | Keep the default 16 MiB witness limit and enable `RPP_PROVER_DETERMINISTIC=1` in CI/regression jobs to spot witness bloat without flaky randomness.【F:config/wallet.toml†L113-L131】【F:docs/architecture/prover-backends.md†L87-L92】 | Development-only backend that exercises the pipeline without producing binding proofs; leave `require_proof` disabled in production so drafts cannot get stuck on non-cryptographic witnesses.【F:docs/wallet_phase2_policies_prover.md†L65-L78】 |
| STWO production prover | `--features prover-stwo` (or `prover-stwo-simd`) | `wallet.prover.backend = "stwo"`; `require_proof` / `allow_broadcast_without_proof`; `timeout_secs`, `max_witness_bytes`, `max_concurrency` | Enforces the same witness ceiling and per-job limits; timeouts and size gates fail open by clearing locks when proofs overrun.【F:docs/wallet_phase2_policies_prover.md†L65-L74】【F:docs/wallet_phase2_policies_prover.md†L93-L122】 | Fully deterministic when `RPP_PROVER_DETERMINISTIC=1`, seeding STWO and sorting setup artifacts for reproducible proofs.【F:docs/architecture/prover-backends.md†L87-L92】 | Compile wallets with the STWO feature for production, keep `max_witness_bytes = 16777216`, and export `RPP_PROVER_DETERMINISTIC=1` in CI. Raise `timeout_secs` only when large drafts routinely exceed the default 300 s budget.【F:config/wallet.toml†L113-L131】【F:docs/wallet_phase2_policies_prover.md†L65-L74】【F:docs/architecture/prover-backends.md†L87-L92】 | Wallet startup fails fast if the STWO feature is missing or mis-specified, preventing silent downgrades to the mock backend; deterministic mode should be disabled for throughput benchmarks to avoid RNG pinning.【F:docs/wallet_phase2_policies_prover.md†L65-L74】【F:docs/architecture/prover-backends.md†L87-L92】 |

## Guidance

- Use the mock backend for development and GUI smoke tests where proof determinism and small witnesses help stabilize coverage; production builds should rely on the STWO backend so draft locking reflects real proof semantics.【F:docs/wallet_phase2_policies_prover.md†L65-L78】
- Keep the witness ceiling at or below the default 16 MiB unless coordination with the node side raises `max_proof_size_bytes` for the verifier; the guardrails protect both wallets and nodes from runaway drafts and mismatched limits.【F:config/wallet.toml†L113-L131】【F:docs/zk_backends.md†L12-L26】【F:docs/zk_backends.md†L67-L84】
- Deterministic proving is recommended for CI and reproducibility. Disable the flag when running performance or latency experiments so the backends can use fresh randomness.【F:docs/architecture/prover-backends.md†L87-L92】
