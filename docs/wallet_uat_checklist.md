# Wallet UAT Checklist

This checklist extends the [Wallet Operator Runbook](wallet_operator_runbook.md) so UAT reviewers can collect end-to-end evidence for every wallet capability before a release. Pair the steps below with the existing runbook prerequisite inventory, CLI walkthrough, and troubleshooting tables so auditors can trace each artefact back to the documented procedure.【F:docs/wallet_operator_runbook.md†L1-L140】

## 1. Environment and data prep

| Area | Instructions |
| --- | --- |
| Build + tooling | Install the pinned Rust toolchains, then build the wallet-enabled node binary with the features you need (for example `cargo build -p rpp-node --features "runtime wallet_gui wallet_hw wallet_multisig_hooks wallet_zsi wallet_rpc_mtls"`). Record the command alongside any `make wallet-regression` runs so feature coverage remains auditable.【F:Makefile†L1-L40】 |
| Local testnet node | Launch `scripts/run_node_mode.sh --config config/node.toml` (or `cargo run -p rpp-node -- node --config config/node.toml`) to seed a regtest-style network. The sample `config/node.toml` binds RPC to `127.0.0.1:7070`, exposes libp2p on `tcp/7600`, and stores data under `./data`, which is sufficient for wallet sync and policy evaluation during UAT.【F:config/node.toml†L6-L178】 |
| Wallet runtime config | Copy `config/wallet.toml` and override only the knobs needed for a scenario (data dir, `[wallet.rpc.*]`, `[wallet.gui]`, `[wallet.backup]`, watch-only, ZSI, rescan, policy, fee, prover, Electrs, etc.). Each section already defaults to regtest-friendly values, so testers can focus on toggling features per step rather than rediscovering schema details.【F:config/wallet.toml†L1-L178】 |
| Mock indexer + tracker | Enable the Electrs runtime/tracker pair by setting `electrs.features.runtime = true` and `electrs.features.tracker = true`, then run the vendor tracker scenario: `cargo test -p rpp-wallet-integration-tests --test vendor_electrs_tracker_scenario -- --ignored`. The `wallet_tracker_rpp` scenario ships the mock block, proof envelope, and VRF digest that the runbook references for receive/send validation.【F:scenarios/wallet_tracker_rpp.toml†L1-L20】【F:docs/electrs_fork_wallet_node_blueprint.md†L149-L189】 |
| Prover endpoints | Leave `wallet.prover.backend = "mock"` and `require_proof = false` for laptop drills or build with STWO prover features, flip `backend = "stwo"`, and (optionally) `require_proof = true` when exercising production circuits. The `[wallet.prover]` block now also controls fail-open behaviour (`allow_broadcast_without_proof`, `timeout_secs`, witness caps, concurrency) so testers can deliberately trigger policy violations in step UAT-06 without touching source code.【F:config/wallet.toml†L142-L152】【F:docs/wallet_phase2_policies_prover.md†L63-L123】 |
| Hardware mocks | Keep `[wallet.hw].enabled = false` with `fallback_to_software = true` until you plug in a supported device or a mock transport. When testing fallback handling (step UAT-14), flip the flag, choose `transport = "hid"|"tcp"`, and watch for `HardwareFallback` events in the logs as described in the Phase‑4 guide.【F:config/wallet.toml†L59-L67】【F:docs/wallet_phase4_advanced.md†L142-L180】 |

## 2. Step-by-step UAT scenarios

| Reference ID | Flow & acceptance goal | Evidence to capture (CLI/GUI/logs) |
| --- | --- | --- |
| **UAT-01 — Onboarding** | Clone the repo, review the prerequisite inventory (data dirs, RPC bindings, hardware, feature flags), and capture the resulting `rpp-wallet migrate` output so schema versions are documented before testing continues.【F:docs/wallet_operator_runbook.md†L9-L43】 | Screenshot or log excerpt showing the migration result and checksum of the config overlay committed to change control. |
| **UAT-02 — Unlock & auto-lock** | Launch the wallet via `scripts/run_wallet_mode.sh` with your config, unlock the keystore, and confirm the UI/CLI honours `[wallet.gui].auto_lock_secs` (300 s by default).【F:scripts/run_wallet_mode.sh†L9-L57】【F:config/wallet.toml†L73-L86】 | CLI output showing unlock + automatic relock timestamp, plus GUI screenshot when applicable. |
| **UAT-03 — Sync to head** | Observe `wallet_sync_status` until the reported height matches the regtest node. When restoring historical seeds, populate `wallet.engine.birthday_height` to avoid missing early funds.【F:docs/wallet_operator_runbook.md†L68-L78】【F:docs/wallet_phase4_advanced.md†L52-L57】【F:config/wallet.toml†L124-L153】 | Capture the sync status JSON and the node height so auditors can confirm parity. |
| **UAT-04 — Receive funds** | Derive a new address (`rpp-wallet address new` or GUI Receive tab), push a regtest transfer, and verify Electrs tracker digests show the proof envelope + VRF metadata described by the tracker scenario.【F:docs/wallet_operator_runbook.md†L78-L87】【F:rpp/wallet-integration-tests/tests/vendor_electrs_tracker_scenario.rs†L127-L287】 | Address derivation log, tracker API response, and wallet history view showing the inbound transaction. |
| **UAT-05 — Send (baseline)** | Draft and submit a spend that satisfies policy defaults (`wallet.policy` gap limits, confirmations, dust budgets, etc.), then confirm the prover backend recorded the attempt (mock or STWO).【F:docs/wallet_phase2_policies_prover.md†L15-L69】 | CLI or GUI send preview, prover log snippet, and confirmation hash once mined. |
| **UAT-06 — Send (policy variations)** | Deliberately breach at least two policies (e.g., set `min_confirmations` above the available UTXO depth, exceed `wallet.policy.spend_limit_daily`, or push a dust-heavy draft) and document the `WALLET_POLICY_VIOLATION` errors surfaced to operators.【F:docs/wallet_phase2_policies_prover.md†L15-L118】 | Error responses with structured diagnostics plus screenshots proving the GUI surfaces the violation. |
| **UAT-07 — Targeted rescan** | Queue a `rpp-wallet rescan --lookback-blocks <n>` and watch the scheduler respect `wallet.rescan.chunk_size` while replaying history; confirm RPC reports pending ranges and completion.【F:docs/wallet_phase2_policies_prover.md†L92-L125】【F:config/wallet.toml†L117-L123】 | CLI output from the rescan command and the follow-up sync status proving completion. |
| **UAT-08 — Backup export** | Trigger `rpp-wallet backup export` (or an auto-export if `wallet.backup.auto_export_enabled = true`) and confirm the archive lands under `wallet.backup.export_dir` with the configured passphrase profile (Argon2id by default).【F:docs/wallet_phase4_advanced.md†L12-L36】【F:config/wallet.toml†L87-L95】 | Hash of the exported `.rppb`, manifest snippet, and log line confirming Argon2id enforcement. |
| **UAT-09 — Backup import / restore** | On an isolated host, run `rpp-wallet backup restore --path <archive>` while the security envelope (mTLS/RBAC) is active to prove maintenance still works in hardened mode.【F:docs/wallet_operator_runbook.md†L88-L102】【F:docs/wallet_phase4_advanced.md†L12-L36】 | Restore command log plus screenshot of the wallet resuming normal sync afterwards. |
| **UAT-10 — Watch-only toggle** | Enable `[wallet.watch_only]` with an exported xpub, restart, and confirm RPC responses label accounts as `watch_only` and that send/broadcast attempts fail with `WatchOnlyError`. Then disable the mode and verify send/receive resumes.【F:docs/wallet_phase4_advanced.md†L34-L63】【F:docs/wallet_operator_runbook.md†L102-L111】【F:config/wallet.toml†L96-L103】 | Before/after RPC snapshots plus CLI error output proving sends are blocked while watch-only is enabled. |
| **UAT-11 — ZSI proof lifecycle** | Build with `wallet_zsi`, enable `[wallet.zsi]`, and walk through `rpp-wallet zsi verify/import` or `zsi issue/rotate` so every lifecycle receipt (and optional proof) is exercised.【F:docs/wallet_phase4_advanced.md†L36-L52】【F:docs/wallet/zsi.md†L1-L52】 | Lifecycle receipt JSON, proof hash, and any GUI/RPC screenshots that display the updated identity registry. |
| **UAT-12 — RBAC + mTLS enforcement** | Turn on `wallet.rpc.security.mtls_required = true` and `role_enforcement = true`, load CA/server material under `wallet.rpc.security.*`, and bind client fingerprints via `[wallet.security]` or the role bindings file. Confirm authorized calls succeed while unauthorized calls return `401/403` with log evidence.【F:docs/wallet_phase4_advanced.md†L100-L141】【F:config/wallet.toml†L27-L48】 | TLS handshake logs, RBAC audit entries, and sample RPC responses for both allowed and rejected clients. |
| **UAT-13 — GUI tab coverage** | With `wallet_gui` enabled, open the History, Send, Receive, and Node tabs and exercise their RPCs (`/wallet/ui/history`, `/send/preview`, `/receive`, `/node`). The iced component renders contract versions and validation state per tab, so screenshots double as schema evidence.【F:validator-ui/src/components/WalletTabs.tsx†L1-L120】【F:validator-ui/src/components/WalletTabs.tsx†L120-L220】 | Full-screen captures of each tab plus the corresponding RPC payloads. |
| **UAT-14 — Hardware mock interactions** | Compile with `wallet_hw`, enable `[wallet.hw]`, and run `rpp-wallet hw test` followed by a send that fails over between hardware and software to prove `fallback_to_software` works (or, when disabled, that errors are surfaced).【F:docs/wallet_phase4_advanced.md†L142-L180】【F:config/wallet.toml†L59-L67】 | CLI transcript from `hw test`, logs highlighting hardware availability/fallback, and the send status. |

## 3. Evidence log and issue feedback loop

1. **Log file** – Append every run to `docs/uat/results_log.md`, filling in the tester, build hash, step IDs exercised, outcome, linked artefacts (logs/screenshots), and any issue URLs. The file is version-controlled so auditors can diff successive test campaigns.
2. **Issue references** – When a step fails or reveals missing documentation, open a GitHub issue (or your tracker equivalent) and include the step ID (e.g., `UAT-06: policy violations leak raw stack traces`). Link the issue number back inside the `results_log.md` row so reviewers can trace mitigation status.
3. **Runbook updates** – If a discrepancy originates from outdated instructions, note it under “Remediation / Docs follow-up” in the log and submit a documentation PR referencing both the issue and the affected UAT step.
4. **Sign-off bundle** – Export the final `results_log.md` snapshot, CLI transcripts, and GUI screenshots as the release evidence package referenced by the Wallet Operator Runbook’s acceptance checklist so change-control boards can attest to readiness.【F:docs/wallet_operator_runbook.md†L1-L120】

Following these steps keeps onboarding, unlock, sync, receive/send (with policy variations), rescans, backups, watch-only toggles, ZSI proofs, RBAC/mTLS enforcement, GUI tabs, and hardware flows reproducible without deep source knowledge while ensuring every gap feeds the tracker with a clear checklist reference.
